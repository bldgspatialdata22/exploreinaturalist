{
  "hash": "07909ccff26789b9762d4012df036157",
  "result": {
    "markdown": "---\ntitle: \"Data Exploration\"\nformat: html\neditor: visual\n---\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# install.packages(\"mapboxapi\")\n# install.packages(\"ggspatial\")\n\nlibrary(readr) # R package for reading and writing data\n#> Warning: package 'readr' was built under R version 4.1.3\nlibrary(sf) # R package for handling simple feature objects\n#> Warning: package 'sf' was built under R version 4.1.3\n#> Linking to GEOS 3.10.2, GDAL 3.4.1, PROJ 7.2.1; sf_use_s2() is TRUE\nlibrary(ggplot2) # R package for creating plots and maps\n#> Warning: package 'ggplot2' was built under R version 4.1.3\nlibrary(dplyr) # R package for data manipulation\n#> Warning: package 'dplyr' was built under R version 4.1.3\n#> \n#> Attaching package: 'dplyr'\n#> The following objects are masked from 'package:stats':\n#> \n#>     filter, lag\n#> The following objects are masked from 'package:base':\n#> \n#>     intersect, setdiff, setequal, union\nlibrary(mapboxapi) # R package for interfacing with Mapbox API. *Requires access token in order to use\n#> Warning: package 'mapboxapi' was built under R version 4.1.3\n#> Usage of the Mapbox APIs is governed by the Mapbox Terms of Service.\n#> Please visit https://www.mapbox.com/legal/tos/ for more information.\n\nmaryland_data <- readr::read_rds(here::here(\"data/maryland_data.rds\"))\n\n\ncoastal_researchgrade <- readr::read_rds(here::here(\"data/coastal_researchgrade.rds\"))\npiedmont_researchgrade <- readr::read_rds(here::here(\"data/piedmont_researchgrade.rds\"))\nbiodiv_researchgrade <- readr::read_rds(here::here(\"data/biodiv_researchgrade.rds\"))\nGBIF_sm <- readr::read_rds(here::here(\"data/GBIF_sm.rds\"))\nGBIF_kingdoms <- readr::read_rds(here::here(\"data/GBIF_kingdoms.rds\"))\n```\n:::\n\n\nIntroduction to the exploration:\n\nData from iNaturalist projects were retrieved using r package \"rinat\" directly from the iNaturalist.\n\niNaturalist data was also retrieved via the Global Biodiversity Information Facility.\n\niNaturalist has multiple projects that vary by geography:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Coastal\ncoastal_research_map <- ggplot() +\n  # Use layer_static_mapbox() to set up base map\n  mapboxapi::layer_static_mapbox(\n    # Make sure to set location to the proper data\n    location = coastal_researchgrade,\n    style_url = \"mapbox://styles/mapbox/light-v10\"\n  ) +\n  # Set object aesthetics\n  ggplot2::geom_sf(\n    mapping = aes(),\n    color = \"red\",\n    size = 2,\n    alpha = 0.3,\n    shape = 4,\n    data = coastal_researchgrade\n  ) +\n  # Add appropriate title and caption\n  labs(\n    title = \"Maryland Coastal Research Grade Observations\",\n    caption = \"Data courtesy of iNaturalist: Master Naturalist Program - Coastal Plain \\n project_id = 474\"\n  )\n# View map and adjust aesthetics\ncoastal_research_map\n```\n\n::: {.cell-output-display}\n![](Data_Exploration_files/figure-html/inat_basic_plots-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Save map as .png file for referencing\nggplot2::ggsave(\"coastal_research_map.png\", plot = coastal_research_map, path = \"deliverables\")\n#> Saving 7 x 5 in image\n\n# Piedmont\npiedmont_research_map <- ggplot() +\n  mapboxapi::layer_static_mapbox(\n    location = piedmont_researchgrade,\n    style_url = \"mapbox://styles/mapbox/light-v10\"\n  ) +\n  ggplot2::geom_sf(\n    mapping = aes(),\n    color = \"blue\",\n    size = 2,\n    alpha = 0.3,\n    shape = 4,\n    data = piedmont_researchgrade\n  ) +\n  labs(\n    title = \"Maryland Piedmont Research Grade Observations\",\n    caption = \"Data courtesy of iNaturalist: Master Naturalist Program - Piedmont Region \\n project_id = 1396\"\n  )\n\npiedmont_research_map\n```\n\n::: {.cell-output-display}\n![](Data_Exploration_files/figure-html/inat_basic_plots-2.png){width=672}\n:::\n\n```{.r .cell-code}\nggplot2::ggsave(\"piedmont_research_map.png\", plot = piedmont_research_map, path = \"deliverables\")\n#> Saving 7 x 5 in image\n\n# State biodiversity data\nbiodiv_researchgrade_map <- ggplot() +\n  mapboxapi::layer_static_mapbox(\n    location = biodiv_researchgrade,\n    style_url = \"mapbox://styles/mapbox/light-v10\"\n  ) +\n  ggplot2::geom_sf(\n    mapping = aes(),\n    size = 2,\n    alpha = 0.3,\n    shape = 4,\n    data = biodiv_researchgrade\n  ) +\n  labs(\n    title = \"Maryland Biodiversity Research Grade Observations\",\n    caption = \"Data courtesy of iNaturalist: Maryland Biodiversity Project \\n project_id = 17241\"\n  ) +\n  ggplot2::theme_classic()\n\nbiodiv_researchgrade_map\n```\n\n::: {.cell-output-display}\n![](Data_Exploration_files/figure-html/inat_basic_plots-3.png){width=672}\n:::\n\n```{.r .cell-code}\nggplot2::ggsave(\"biodiv_research_map.png\", plot = biodiv_researchgrade_map, path = \"deliverables\")\n#> Saving 7 x 5 in image\n```\n:::\n\n\nCan multiple projects be presented in a single map?\n\nCombine multiple iNaturalist project data by creating a project variable which can be used as a color indicator when mapping.\n\nThe \\$project value will refer to the project's ID, in this case I'm using \"Coastal\" and \"Piedmont\".\n\nCreate a new data.frame where both coastal and piedmont projects are included by using bind_rows().\n\nNow the data is ready to be plotted.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Add a project indicator variable\ncoastal_researchgrade$project <- \"Coastal\"\npiedmont_researchgrade$project <- \"Piedmont\"\n\n# Combine project data into a single sf object\nregion_researchgrade <-\n  dplyr::bind_rows(\n    coastal_researchgrade,\n    piedmont_researchgrade\n  )\n\nmasternat_map <- ggplot() +\n  mapboxapi::layer_static_mapbox(\n    location = region_researchgrade,\n    style_url = \"mapbox://styles/mapbox/light-v10\"\n  ) +\n  ggplot2::geom_sf(\n    mapping = aes(color = project),\n    size = 1,\n    alpha = 0.5,\n    shape = 4,\n    data = region_researchgrade\n  ) +\n  # ggplot2::geom_sf_label() +\n  labs(\n    title = \"Maryland Master Naturalist Research Grade Observations\",\n    caption = \"Data combined from piedmont and coastal regional projects\"\n  ) +\n  ggplot2::theme_classic()\n\nmasternat_map\n```\n\n::: {.cell-output-display}\n![](Data_Exploration_files/figure-html/inat_combined_plot-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggplot2::ggsave(\"masternat_map.png\", plot = masternat_map, path = \"deliverables\")\n#> Saving 7 x 5 in image\n```\n:::\n\n\nWe can look at location and number of observations reported by each user\n\n\n::: {.cell}\n\n```{.r .cell-code}\n\n# Use region_researchgrade data to plot the number of observations by users.\n# Use color aesthic to distinguish between observations for each project.\nmasternat_user_plot <-\n  ggplot(region_researchgrade, aes(user.login, fill = project)) +\n  ggplot2::geom_bar() +\n  scale_fill_brewer(\n    type = \"qual\",\n    palette = \"Dark2\",\n  ) +\n  # Flip axes so usernames are more legible\n  coord_flip() +\n  guides(fill = \"none\") +\n  labs(title = \"Observations per User by Project\") +\n  # Add legend\n  guides(fill = guide_legend(title = \"Project\")) +\n  ggplot2::theme_classic()\n\nmasternat_user_plot\n```\n\n::: {.cell-output-display}\n![](Data_Exploration_files/figure-html/inat_user_plot-1.png){width=672}\n:::\n\n```{.r .cell-code}\n\nggplot2::ggsave(\"masternat_user_plot.png\", plot = masternat_user_plot, path = \"deliverables\")\n#> Saving 7 x 5 in image\n\npiedmont_user_map <- ggplot() +\n  mapboxapi::layer_static_mapbox(\n    location = piedmont_researchgrade,\n    style_url = \"mapbox://styles/mapbox/light-v10\"\n  ) +\n  ggplot2::geom_sf(\n    mapping = aes(color = user.login),\n    size = 2,\n    alpha = 0.5,\n    data = piedmont_researchgrade\n  ) +\n  # Add labels\n  labs(\n    title = \"Maryland Master Naturalist Observations by User\\nPiedmont Region\",\n    caption = \"Data courtesy of iNaturalist: Master Naturalist Program - Piedmont Region\\nproject_id = 1396\"\n  ) +\n  ggplot2::theme_classic()\n\npiedmont_user_map\n```\n\n::: {.cell-output-display}\n![](Data_Exploration_files/figure-html/inat_user_plot-2.png){width=672}\n:::\n\n```{.r .cell-code}\n# FIXME: adjust caption to fit in whitespace\n\nggplot2::ggsave(\"piedmont_user_map.png\", plot = piedmont_user_map, path = \"deliverables\")\n#> Saving 7 x 5 in image\n\n# Filter out observations from the user with the most observations according to masternat_user_plot\nmmn_noriko_obs <-\n  filter(piedmont_researchgrade, user.login == \"mmn_noriko\")\n# Map top user's observations\ntopuser_piedmont <- ggplot() +\n  mapboxapi::layer_static_mapbox(\n    location = mmn_noriko_obs,\n    style_url = \"mapbox://styles/mapbox/light-v10\"\n  ) +\n  # Set color aesthetic to the number of photos taken per observation\n  ggplot2::geom_sf(\n    mapping = aes(color = observation_photos_count),\n    size = 2,\n    alpha = 0.25,\n    data = mmn_noriko_obs\n  ) +\n  labs(\n    title = \"Top User's Observations in MD Piedmont Region\",\n    caption = 'User \"mmn_noriko\" reported 2110 research grade observations\\n for the Maryland Master Naturalist Piedmont Region iNaturalist Project'\n  ) +\n  ggplot2::theme_classic()\n\ntopuser_piedmont\n```\n\n::: {.cell-output-display}\n![](Data_Exploration_files/figure-html/inat_user_plot-3.png){width=672}\n:::\n\n```{.r .cell-code}\n# FIXME: Center title label, change colors of points, increase transparency\nggplot2::ggsave(\"topuser_piedmont.png\", plot = topuser_piedmont, path = \"deliverables\")\n#> Saving 7 x 5 in image\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncoastal_user_map <- ggplot() +\n  mapboxapi::layer_static_mapbox(\n    location = coastal_researchgrade,\n    style_url = \"mapbox://styles/mapbox/light-v10\"\n  ) +\n  ggplot2::geom_sf(\n    mapping = aes(color = user.login),\n    size = 2,\n    alpha = 0.5,\n    data = coastal_researchgrade\n  ) +\n  guides(fill = guide_legend(ncol = 2)) +\n  # Add labels\n  labs(\n    title = \"Maryland Master Naturalist Observations by User\\nCoastal Region\",\n    caption = \"Data courtesy of iNaturalist: Master Naturalist Program - Coastal Plain \\n project_id = 474\"\n  ) +\n  ggplot2::theme_classic()\n\ncoastal_user_map\n```\n\n::: {.cell-output-display}\n![](Data_Exploration_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# FIXME: Make legend two columns\nggplot2::ggsave(\"coastal_usermap.png\", plot = coastal_user_map, path = \"deliverables\")\n#> Saving 7 x 5 in image\n\n# Filter out observations from the user with the most observations according to masternat_user_plot\ntonyiajohnson_obs <-\n  dplyr::filter(coastal_researchgrade, user.login == \"tonyiajohnson\")\n# Map top user's observations\ntopuser_coastal <- ggplot() +\n  mapboxapi::layer_static_mapbox(\n    location = tonyiajohnson_obs,\n    style_url = \"mapbox://styles/mapbox/light-v10\"\n  ) +\n  ggplot2::geom_sf(\n    mapping = aes(color = observation_photos_count),\n    size = 2,\n    alpha = 0.5,\n    data = tonyiajohnson_obs\n  ) +\n  scale_fill_brewer(\n    type = \"seq\",\n    palette = \"OrRd\"\n  ) +\n  labs(\n    title = \"Top User's Observations in MD Coastal Region\",\n    caption = 'User \"tonyiajohnson\" reported 2110 research grade observations\\n for the Maryland Master Naturalist Coastal Region iNaturalist Project'\n  ) +\n  ggplot2::theme_classic() +\n  ggplot2::theme(\n    axis.text.x = element_text(angle = -30, vjust = 1, hjust = 0)\n  )\n\ntopuser_coastal\n```\n\n::: {.cell-output-display}\n![](Data_Exploration_files/figure-html/unnamed-chunk-2-2.png){width=672}\n:::\n\n```{.r .cell-code}\n# FIXME: adjust label positions, widen x-limits\nggplot2::ggsave(\"topuser_coastal.png\", plot = topuser_coastal, path = \"deliverables\")\n#> Saving 7 x 5 in image\n```\n:::\n\n\nWe can look at variation by kingdom, genus and species:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nGBIF_kingdoms_bar <-\n  ggplot(GBIF_sm, aes(x = kingdom, fill = kingdom)) +\n  ggplot2::geom_bar() +\n  scale_fill_brewer(\n    type = \"qual\",\n    palette = \"Dark2\"\n  ) +\n  guides(fill = \"none\") +\n  ggplot2::geom_text(\n    aes(\n      label = ..count..\n    ),\n    stat = \"count\",\n    vjust = -0.2,\n    colour = \"black\"\n  ) +\n  labs(\n    title = \"Distribution of Observations by Kingdom\",\n    caption = \"Data courtesy of iNaturalist Research-Grade Observations via GBIF\"\n  ) +\n  ggplot2::theme_classic()\n\nGBIF_kingdoms_bar\n#> Warning: The dot-dot notation (`..count..`) was deprecated in ggplot2 3.4.0.\n#> i Please use `after_stat(count)` instead.\n```\n\n::: {.cell-output-display}\n![](Data_Exploration_files/figure-html/gbif_plots-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# FIXME: Center title position\n\nggplot2::ggsave(\"GBIF_kingdoms_bar.png\", plot = GBIF_kingdoms_bar, path = \"deliverables\")\n#> Saving 7 x 5 in image\n\n# Create data\nplants_vs_animals <-\n  filter(\n    GBIF_sm, kingdom == c(\"Animalia\", \"Plantae\")\n  )\n\n\n\n# plants_vs_animals_bar <-\n#  ggplot(plants_vs_animals, aes(x = kingdom, fill = kingdom)\n#  ) +\n#  ggplot2::geom_bar() +\n#  scale_fill_brewer(\n#    type = \"qual\",\n#    palette = \"Dark2\") +\n#  guides(fill = \"none\") +\n#   labs(title = \"Plants vs Animals\") +\n#   ggplot2::geom_text(aes(label = ..count..), stat = \"count\", vjust = -0.2, colour = \"black\")\n\n# plants_vs_animals_bar\n# ggplot2::ggsave(\"plants_vs_animals_bar.png\", plot = plants_vs_animals_bar, path = \"deliverables\")\n\n# Compute the position of labels\n# data <- plants_vs_animals %>%\n#  arrange(desc(kingdom)) %>%\n# mutate(prop = kingdom / sum(plants_vs_animals$kingdom) *100) %>%\n#  mutate(ypos = cumsum(prop)- 0.5*prop )\n\n# Basic piechart\n# ggplot(data, aes(x=\"\", y=prop, fill=group)) +\n#  ggplot2::geom_bar(stat=\"identity\", width=1, color=\"white\") +\n#  coord_polar(\"y\", start=0) +\n#  ggplot2::theme_void() +\n#  ggplot2::theme(legend.position=\"none\") +\n\n#  ggplot2::geom_text(aes(y = ypos, label = group), color = \"white\", size=6) +\n#  scale_fill_brewer(palette=\"Set1\")\n\n# Other kingdoms\n# minorities_kingdoms <-\n#  filter(\n#    GBIF_sm, kingdom == c(\"Bacteria\", \"Chromista\", \"Fungi\", \"Protozoa\", \"Viruses\"))\n# bar chart\n# minorities_kingdoms_bar <-\n#  ggplot(minorities_kingdoms, aes(x = kingdom, fill = kingdom)\n#  ) +\n#  ggplot2::geom_bar() +\n#  scale_fill_brewer(\n#    type = \"qual\",\n#    palette = \"Dark2\") +\n#  guides(fill = \"none\") +\n#   labs(title = \"Minority Kingdoms Observed\") +\n#   ggplot2::geom_text(aes(label = ..count..), stat = \"count\", vjust = -0.2, colour = \"black\")\n\n# minorities_kingdoms_bar\n```\n:::\n\n\nOf the 84 unique bird species observed by users in Maryland, how many were corvids (crow family)?\n\nFIlter GBIF_MD_research_grade to return only observations in the family \"Corvidae\". Make sure to disclude observations where the species attribute is missing or NA. Transform dataframe into a spatial dataframe, assigning the lat/lon columns to coords to create the ggplot2::geometry column.\n\nWhat species of corvidae were observed in Maryland? What was the most common corvid species? The least common?\n\nPlot corvid observations on a bar chart. Set aesthetics to show each species as its own bar. Label count at the top of each bar. Set fill to species. Set scale_fill_brewer aesthetics type as qualitative and palette to Set1. Call coord_flip to rotate plot so the x-axis and y-axis are switched.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nMD_corvids <-\n  GBIF_sm %>%\n  group_by(genus) %>%\n  filter(family == \"Corvidae\", !is.na(species))\n\nMD_corvids_bar <-\n  ggplot(MD_corvids, aes(x = species, fill = species)) +\n  ggplot2::geom_bar() +\n  scale_fill_brewer(\n    type = \"qual\",\n    palette = \"Set1\"\n  ) +\n  guides(fill = \"none\") +\n  coord_flip() +\n  ggplot2::theme_classic()\n\nMD_corvids_bar\n```\n\n::: {.cell-output-display}\n![](Data_Exploration_files/figure-html/gbif_corvids-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggplot2::ggsave(\"MD_corvids_bar.png\", plot = MD_corvids_bar, path = \"deliverables\")\n#> Saving 7 x 5 in image\n```\n:::\n\n\nWhere were corvids observed in Maryland? Are there any hotspots for corvid observations?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nMD_corvid_sightings <- ggplot() +\n  mapboxapi::layer_static_mapbox(\n    location = MD_corvids,\n    style_url = \"mapbox://styles/mapbox/light-v10\"\n  ) +\n  ggplot2::geom_sf(\n    data = MD_corvids,\n    aes(color = species),\n    alpha = 0.7,\n    size = 0.3\n  ) +\n  scale_color_brewer(\n    type = \"qual\",\n    palette = \"Set1\"\n  ) +\n  labs(\n    title = \"Crows and Blue Jays in Maryland\",\n    caption = \"Data courtesy of iNaturalist Research-Grade Observations via GBIF\"\n  ) +\n  ggplot2::theme_classic() +\n  ggplot2::theme(\n    legend.position = \"bottom\"\n  )\n\nMD_corvid_sightings\n```\n\n::: {.cell-output-display}\n![](Data_Exploration_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# FIXME: Center title position\nggplot2::ggsave(\"MD_corvid_sightings.png\", plot = MD_corvid_sightings, path = \"deliverables\")\n#> Saving 7 x 5 in image\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create new data.frame containing only insect sightings\nMD_insects <-\n  GBIF_sm %>%\n  dplyr::group_by(family) %>%\n  dplyr::filter(class == \"Insecta\", !is.na(species))\n# What families of insects are most commonly sighted?\nMD_insects_by_family <- MD_insects %>%\n  dplyr::summarise(max = max(family), n = n()) %>%\n  dplyr::arrange(desc(n))\n# Nymphalidae\tn = 3826\n# Noctuidae\t n = 3788\n# Libellulidae\tn = 2900\n# What are the least commonly sighted?\n# There 40 families of insects that have only been reported once\n#\n# Filter the sf data.frame down to the 40 insect families with single reportings (n = 1)\nMD_rare_insects_inc <- MD_insects_by_family %>%\n  dplyr::filter(n == 1)\n# Drop ggplot2::geometry before performing join\nMD_rare_insects_df <- sf::st_drop_geometry(MD_rare_insects_inc)\n# Perform left join where x = MD_rare_insects and y = MD_insects, resulting in a data.frame of 40 rows x 12 columns.\nMD_rare_insects <-\n  left_join(MD_rare_insects_df, MD_insects)\n#> Joining, by = \"family\"\n# Transform back into sf object.\nMD_rare_insects_sf <- sf::st_as_sf(MD_rare_insects, crs = 3857)\n\n# Map rare insect sightings\nMD_rare_insects_map <- ggplot() +\n  mapboxapi::layer_static_mapbox(\n    location = MD_rare_insects_sf,\n    style_url = \"mapbox://styles/mapbox/light-v10\"\n  ) +\n  ggplot2::geom_sf(\n    data = MD_rare_insects_sf,\n    shape = 17,\n    size = 3,\n    alpha = 0.5,\n    color = \"orange\"\n  ) +\n  scale_color_brewer(\n    type = \"qual\",\n    palette = \"Set2\"\n  ) +\n  labs(\n    title = \"Rare Sightings of Insects in Maryland\",\n    caption = \"Plotted are 40 unique insect species reported by users in Maryland on iNaturalist.\\nNote: The rarity of these insect species have not been cross-referenced with ICUN Red List.\"\n  ) +\n  ggplot2::theme_classic() +\n  ggplot2::theme(\n    legend.position = \"none\"\n  )\n\nMD_rare_insects_map\n```\n\n::: {.cell-output-display}\n![](Data_Exploration_files/figure-html/gbif_insects-1.png){width=672}\n:::\n\n```{.r .cell-code}\n\nggplot2::ggsave(\"MD_rare_insects_map.png\", plot = MD_rare_insects_map, path = \"deliverables\")\n#> Saving 7 x 5 in image\n```\n:::\n",
    "supporting": [
      "Data_Exploration_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}