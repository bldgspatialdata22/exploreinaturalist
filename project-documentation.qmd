---
title: "Final Project"
author: "Kari Moy"
format: html
editor: visual
---

# Project Proposal

### Defining your goals

*In framing your project, look for opportunities to apply one or more of the six models of local practice described in @loukissas2019:*

-   *Look at the data setting, not just the data set*

    -   "Place is something less easily defined: contingent on experience, defined by meaning, susceptible to changing social designations," (p. 20 Loukissas)

    -   iNaturalist as a research and community platform -- a cyperspace

    -   Allows citizen engagement in grassroots scientific research

        -   How is iNaturalist an ideal platform for citizen science? Or is it? Can if be improved?

        -   Does iNaturalist meet the goal of obtaining meaningful and useful data that advances scientific research and can be applied to real world problems?

        -   Is iNatualist data easily accessible for research purposes?

            -   rinat: Access iNaturalist data with R

            -   GBIF: Global Biodiversity Information Facility

            -   "Anyone with an account can export data from iNaturalist as a spreadsheet in csv format. You can start from the Explore page and click download in the lower right of the filters box. Or you can go directly to the export page (https://www.inaturalist.org/observations/export).

                If you plan to publish a paper using iNaturalist data, we recommend downloading iNaturalist data from the Global Biodiversity Information Facility because they will issue a citable DOI (see below for more details)." (https://www.inaturalist.org/pages/help#export)

-   *Make place part of data presentation*

    -   Can amateur bioblitz/biodiversity observations hold enough merit to be included in data sets for professional or academic research?

        -   offers research grade status

        -   Who qualifies the data as research grade?

            -   "Observations become **"Research Grade"** when the **community agrees on species-level ID or lower**, i.e. when more than 2/3 of identifiers agree on a taxon" (https://www.inaturalist.org/pages/help#quality)

        -   How are identifications confirmed?

-   *Take a comparative approach to data analysis*

    -   How does citizen science data compare to professional inventory data in the same or similar areas?

    -   How does user access to iNaturalist data compare to that of Socrata data or iMap data?

        -   limited \# of requests due to API limits (10,000 requests per day, 100 requests per minute)
        -   Does iNaturalist or citizen science data have a place in research?

-   Create counterdata to challenge normative algorithms

    -   iNaturalist data should be considered the counterdata to data collected by government, academic, and industry institutions.
        -   Can iNaturalist data be used to support finding in more official data formats?

-   Create interfaces that cause friction

    -   Offers map interface to view all observations, filter observations by various attributes (ei. biota, location, temporal, author), calculates general statistics of Project's observation data.

    -   Where could further improvements be made to the interface?

-   Use data to build relationships

    -   

## Set Up

```{r}
#| label: setup
# remotes::install_github("ropensci/rinat")
# remotes::install_github("ropensci/rgbif")
library(rinat)
library(rgbif)
library(tidyverse)
library(ggplot2)
```

## Getting Spatial Data

Use get_inat_obs_project() to get observation data.

-   type = "info" argument returns \# of observations in data set

-   type = "observations" argument returns all observations in data set

-   cannot filter data from project using this function.

```{r}
#| eval: false
MD_masternat_piedmont <- get_inat_obs_project("maryland-master-naturalist-program-piedmont-region", type = "observations")

readr::write_rds(MD_masternat_piedmont, here::here("data/MD_masternat_piedmont.rds"))

MD_masternat_coastal <- get_inat_obs_project("maryland-master-naturalist-program-coastal-plain", type = "observations")

readr::write_rds(MD_masternat_coastal, here::here("data/MD_masternat_coastal.rds"))

MD_biodiversity <- get_inat_obs_project("biodiversity-of-maryland", type = "observations")

readr::write_rds(MD_biodiversity, here::here("data/MD_biodiversity.rds"))
```


```{r}
# Read data saved to data folder
MD_masternat_piedmont <- readr::read_rds(here::here("data/MD_masternat_piedmont.rds"))

MD_masternat_coastal <- readr::write_rds(here::here("data/MD_masternat_coastal.rds"))

MD_biodiversity <- readr::read_rds(here::here("data/MD_biodiversity.rds"))
```


-   OK -- I can access spatial datasets from iNaturalist using rinat :: get_inat_obs_projct(). However, for projects with more observations I cannot subset data using this function, so it will take a long time to retrieve the full dataset (ei. MD_masternat_piedmont only has 3934 observations, whereas the MD_biodiversity contains over 1 million observations and can only return 10,000 observations due to the limits of iNaturalist's current API.

    -   Actually, only returned 9999 observations and displayed this note:

        -   Note: mismatch between number of observations reported and returned by the API.

## Testing other rinat functions:

```{r}
## Map 100 spotted salamanders
a_mac <- get_inat_obs(taxon_name = "Ambystoma maculatum", year = 2021)
salamander_map <- inat_map(a_mac, plot = FALSE)

### Further customise the returned ggplot object
salamander_map + borders("state") + theme_bw()
```

Attempting to reduce the number of columns (75) down to a manageable and also relevent number of columns.

Is there a list of column descriptions anywhere in the iNaturalist API documentation?

-   "id" = unique observation ID

-   "observed_on" = user reported date of observation

-   "description" = user reported qualitative data to help with species ID

-   "latitude" & "longitude"

```{r}
glimpse(MD_masternat_piedmont)
colnames(MD_masternat_piedmont)
# FIXME: You're using mutate() but it looks like you meant to use select() - I commented out your code and provided a sample below showing how to use select()
# keep_col <- c("id", "observed_on", "description", "latitude", "longitude","")
# MD_masternat_piedmont_sm <- mutate(MD_masternat_piedmont,keep_col)

MD_masternat_piedmont_sm <- MD_masternat_piedmont %>%
  select(all_of(c("id", "observed_on", "description", "latitude", "longitude")))
  
```

After further research I have decided that accessing data through GBIF will be a more reliable way to gather data from iNaturalist.

-   I will attempt to explore iNaturalist research-grade data.
-   Is there a way to filter GBIF\<iNaturalist\<research-grade\<by project? Or \<geolocation?
    -   There are advanced filter options on the GBIF website to filter down to geolocation.
    -   I'm not sure yet how to perform these filter options within R, but I'm not sure it's necessary either.

```{r}
# Confirm 2-letter country code for United States
rgb_country_codes(country_name = "United", fuzzy = FALSE)
```


```{r}
# Recreate data occurance search done on website with the following filters:

#country or area = United States of America
#dataset = iNaturalist Research-grade Observations (50c9509d-22c7-4a22-a47d-8c48425ef4a7)
#has coordinate = true
#has geospatial issue = false
#occurance statis = present
#state province = Maryland
GBIF_MD_research_grade <-
  occ_search(
  taxonKey = NULL,
  scientificName = NULL,
  country = "US",
  datasetKey =  "50c9509d-22c7-4a22-a47d-8c48425ef4a7",
  hasCoordinate = TRUE,
  hasGeospatialIssue = FALSE,
  occurrenceStatus = "present",
  stateProvince = "Maryland"
)

# Subset data tibble and assign to original variable 
# FIXME: You should save the metadata attached to the original results from occ_search() in case you need it later. Your original code just replaced the original results with the data
GBIF_MD_research_grade_full <- GBIF_MD_research_grade
GBIF_MD_research_grade <- GBIF_MD_research_grade$data
```

## Start exploring GBIF data

```{r}
# Explore data
glimpse(GBIF_MD_research_grade)
colnames(GBIF_MD_research_grade)
# Filter data to find all distinct species
MD_species <- GBIF_MD_research_grade %>% count(scientificName)
# iNaturalist research-grade data has 210 unique species reported in Maryland
MD_classcount <- GBIF_MD_research_grade %>% count(class)
# 24 unique biological classes are reported in the data
# Highest number of observations per class is reported in Aves (birds) at 286 observations.
MD_unique_birds <- GBIF_MD_research_grade %>%
  filter(class == "Aves") %>%
  count(genus, species)
# Of the 286 bird observations, 84 unique species have been reported in this dataset.

# TODO: Consider using knitr::kable() or gt::gt() to create tables based on these counts - see the example below
MD_unique_birds %>% 
  arrange(desc(n)) %>% 
  knitr::kable()
```

## Comparative Exploration

Now that we have learned a bit about the extent of iNaturalist data that has been reported to be research-grade, we can start to explore how publicly obtained observations in the state of Maryland compare to more strategic methods of collecting biological data.

Data obtained through the means of ecological surveys are conducted for two basic reasons--to determine the biological health of a habitat and to inform better decision-making for action plans.
